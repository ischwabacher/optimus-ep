#!/usr/bin/env ruby

# Part of the Optimus package for managing E-Prime data
# 
# Copyright (C) 2008 Board of Regents of the University of Wisconsin System
# 
# Written by Nathan Vack <njvack@wisc.edu>, at the Waisman Laborotory for Brain
# Imaging and Behavior, University of Wisconsin - Madison

require 'rubygems'
require 'optparse'
gem 'optimus-ep'
require 'runners/generic_runner'
require 'ruby-prof'
t1 = Time.now.to_f
begin
  RubyProf.start
  
  txr = Eprime::Runners::GenericRunner.new(Eprime::Transformers::TimingExtractor, ARGV)
  txr.process!
  result = RubyProf.stop
  printer = RubyProf::GraphHtmlPrinter.new(result)
  File.open('calls2.html', 'w') do |f|
    printer.print(f)
  end
  
rescue ArgumentError => e
  STDERR.puts e.message
  exit 1
rescue Exception => e
  STDERR.puts e.message
  exit 2
end
dur = Time.now.to_f - t1

puts "Total time: #{dur} s"
